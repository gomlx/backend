// Code generated by github.com/ajroetker/go-highway/cmd/hwygen. DO NOT EDIT.

//go:build arm64

package nn

import (
	"github.com/ajroetker/go-highway/hwy"
)

var DenseFloat16 func(x []hwy.Float16, weight []hwy.Float16, bias []hwy.Float16, output []hwy.Float16, batchSize int, inFeatures int, outFeatures int)
var DenseBFloat16 func(x []hwy.BFloat16, weight []hwy.BFloat16, bias []hwy.BFloat16, output []hwy.BFloat16, batchSize int, inFeatures int, outFeatures int)
var DenseFloat32 func(x []float32, weight []float32, bias []float32, output []float32, batchSize int, inFeatures int, outFeatures int)
var DenseFloat64 func(x []float64, weight []float64, bias []float64, output []float64, batchSize int, inFeatures int, outFeatures int)

// Dense computes a dense (fully-connected) layer: output = x @ weight^T + bias.
//
//   - x is [batchSize, inFeatures] (row-major)
//   - weight is [outFeatures, inFeatures] (row-major, PyTorch format)
//   - bias is [outFeatures] (optional, pass nil to skip)
//   - output is [batchSize, outFeatures] (row-major)
//
// This uses SIMD dot-product accumulation along inFeatures with 4-row unrolling,
// matching the BaseMatMulKLast pattern, plus an optional SIMD bias add.
//
// This function dispatches to the appropriate SIMD implementation at runtime.
func Dense[T hwy.Floats](x []T, weight []T, bias []T, output []T, batchSize int, inFeatures int, outFeatures int) {
	switch any(x).(type) {
	case []hwy.Float16:
		DenseFloat16(any(x).([]hwy.Float16), any(weight).([]hwy.Float16), any(bias).([]hwy.Float16), any(output).([]hwy.Float16), batchSize, inFeatures, outFeatures)
	case []hwy.BFloat16:
		DenseBFloat16(any(x).([]hwy.BFloat16), any(weight).([]hwy.BFloat16), any(bias).([]hwy.BFloat16), any(output).([]hwy.BFloat16), batchSize, inFeatures, outFeatures)
	case []float32:
		DenseFloat32(any(x).([]float32), any(weight).([]float32), any(bias).([]float32), any(output).([]float32), batchSize, inFeatures, outFeatures)
	case []float64:
		DenseFloat64(any(x).([]float64), any(weight).([]float64), any(bias).([]float64), any(output).([]float64), batchSize, inFeatures, outFeatures)
	}
}

func init() {
	if hwy.NoSimdEnv() {
		initDenseFallback()
		return
	}
	initDenseNEON()
	return
}

func initDenseNEON() {
	DenseFloat16 = BaseDense_neon_Float16
	DenseBFloat16 = BaseDense_neon_BFloat16
	DenseFloat32 = BaseDense_neon
	DenseFloat64 = BaseDense_neon_Float64
}

func initDenseFallback() {
	DenseFloat16 = BaseDense_fallback_Float16
	DenseBFloat16 = BaseDense_fallback_BFloat16
	DenseFloat32 = BaseDense_fallback
	DenseFloat64 = BaseDense_fallback_Float64
}
